<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Valentine</title>

<style>
  :root{
    --card-w: min(980px, 92vw);
    --card-h: min(480px, 74vh);
    --pink: #ff3b7b;
  }
  *{ box-sizing:border-box; }

  body{
    margin:0;
    min-height:100vh;
    display:grid;
    place-items:center;
    font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
    background: radial-gradient(circle at top, #fff3f6, #ffe6ee);
    overflow:hidden;
  }

  /* Blur/dim on YES */
  body.blur-bg .stage{ filter: blur(10px); transform: scale(1.02); }
  body.blur-bg .shade{ opacity:1; pointer-events:auto; }
  body.blur-bg .polaroid-wrap{ opacity:1; pointer-events:auto; transform:none; }

  .shade{
    position:fixed; inset:0;
    background:rgba(0,0,0,0.22);
    opacity:0;
    pointer-events:none;
    transition:0.35s;
    z-index:10;
  }

  .stage{
    width:var(--card-w);
    height:var(--card-h);
    position:relative;
    transition:0.35s;
  }

  .card{
    width:100%; height:100%;
    background:white;
    border-radius:28px;
    box-shadow:0 20px 60px rgba(0,0,0,0.12);
    padding:52px 26px;
    text-align:center;
    position:relative;
    overflow:hidden;
  }

  h1{
    font-size:clamp(28px,4vw,58px);
    margin:0;
    font-weight:850;
    letter-spacing:-0.02em;
    line-height:1.05;
  }
  .sub{ margin-top:10px; opacity:.7; font-size:16px; }

  .btn{
    position:absolute;
    border:0;
    border-radius:14px;
    padding:14px 22px;
    font-size:18px;
    cursor:pointer;
    user-select:none;
    will-change:left, top;
  }

  #yes{
    background:var(--pink);
    color:white;
    left:50%;
    top:59%;
    transform:translateX(-70%);
    box-shadow:0 12px 30px rgba(255,59,123,.25);
  }

  /* JS positions #no, so no transform here */
  #no{
    background:#f1f1f1;
    color:#222;
    left:50%;
    top:64%;
    transform:none;
    box-shadow:0 10px 22px rgba(0,0,0,.08);
  }

  .toast{
    position:absolute;
    left:50%;
    bottom:22px;
    transform:translateX(-50%);
    background:rgba(0,0,0,.75);
    color:#fff;
    padding:10px 14px;
    border-radius:999px;
    font-size:14px;
    opacity:0;
    transition:.2s;
    pointer-events:none;
  }
  .toast.show{ opacity:1; }

  /* Polaroid modal */
  .polaroid-wrap{
    position:fixed; inset:0;
    display:grid;
    place-items:center;
    opacity:0;
    pointer-events:none;
    transform: translateY(12px) scale(0.98);
    transition:.35s;
    z-index:20;
  }

  .polaroid{
    width:min(380px,88vw);
    background:white;
    border-radius:18px;
    padding:16px 16px 18px;
    box-shadow:0 30px 90px rgba(0,0,0,.28);
    position:relative;
  }

  .polaroid::before{
    content:"";
    position:absolute;
    inset:-14px;
    border-radius:26px;
    background:
      radial-gradient(circle at 20% 10%, rgba(255,59,123,0.18), transparent 55%),
      radial-gradient(circle at 80% 90%, rgba(255, 214, 231, 0.65), transparent 55%);
    filter: blur(14px);
    z-index:-1;
  }

  .close{
    position:absolute;
    top:10px; right:10px;
    width:36px; height:36px;
    border-radius:50%;
    border:0;
    cursor:pointer;
    background:rgba(0,0,0,0.06);
  }
  .close:hover{ background:rgba(0,0,0,0.12); }

  .photo{
    width:100%;
    aspect-ratio:1/1;
    border-radius:14px;
    overflow:hidden;
    background:#f6f6f6;
    border:2px solid rgba(0,0,0,0.06);
    position: relative;
  }
  .photo img{ width:100%; height:100%; object-fit:cover; display:block; }

  /* Heart container sits on top of the photo */
  .heart-layer{
    position:absolute;
    inset:0;
    pointer-events:none;
    overflow:hidden;
  }

  .caption{ margin-top:12px; text-align:center; }
  .caption .big{ font-size:18px; font-weight:800; }
  .caption .small{ margin-top:4px; opacity:.75; font-size:14px; }

  /* Continuous hearts (float around photo) */
  .float-heart{
    position:absolute;
    bottom:-18px;
    font-size:18px;
    opacity:0;
    animation: floatHeart var(--dur) ease-in forwards;
    filter: drop-shadow(0 10px 14px rgba(0,0,0,0.18));
    user-select:none;
    pointer-events:none;
  }
  @keyframes floatHeart{
    0%   { transform: translate(var(--x0), 0) scale(var(--s)); opacity: 0; }
    10%  { opacity: 1; }
    100% { transform: translate(var(--x1), -120%) scale(calc(var(--s) + 0.15)); opacity: 0; }
  }
</style>
</head>

<body>
  <div class="shade" id="shade"></div>

  <div class="stage">
    <div class="card" id="card">
      <h1>Irina Karyakina, will you be my Valentine? üíò</h1>
      <div class="sub">Choose wisely üòá</div>

      <button class="btn" id="yes">Yes ‚ú®üíû</button>
      <button class="btn" id="no">No üôà</button>

      <div class="toast" id="toast"></div>
    </div>
  </div>

  <div class="polaroid-wrap">
    <div class="polaroid" role="dialog" aria-modal="true">
      <button class="close" id="close" aria-label="Close">‚úï</button>

      <div class="photo" id="photoBox">
        <img src="us.jpg" alt="Us">
        <div class="heart-layer" id="heartLayer"></div>
      </div>

      <div class="caption">
        <div class="big">Best decision everüíñ</div>
        <div class="small">Good Job!üåπ</div>
      </div>
    </div>
  </div>

<script>
  const card = document.getElementById("card");
  const btnNo = document.getElementById("no");
  const btnYes = document.getElementById("yes");
  const toast = document.getElementById("toast");
  const shade = document.getElementById("shade");
  const closeBtn = document.getElementById("close");

  const heartLayer = document.getElementById("heartLayer");
  const photoBox = document.getElementById("photoBox");

  const mockLines = [
    "Nice try üòè",
    "Not today üôà",
    "Too slow üòå",
    "You thought üòÇ",
    "Almost! But no üòá",
    "Keep trying üòâ",
    "Aww, adorable attempt ü•∫"
  ];

  // --- NO chase: starts still, begins after first attempt ---
  const state = { x: 0, y: 0, vx: 0, vy: 0 };
  let chaseStarted = false;
  let rafId = null;
  let lastMock = 0;

  function rect(el){ return el.getBoundingClientRect(); }
  function randDir(){
    const a = Math.random() * Math.PI * 2;
    return { x: Math.cos(a), y: Math.sin(a) };
  }

  function showMock(){
    const now = performance.now();
    if (now - lastMock < 260) return;
    lastMock = now;

    toast.textContent = mockLines[Math.floor(Math.random() * mockLines.length)];
    toast.classList.add("show");
    setTimeout(() => toast.classList.remove("show"), 900);
  }

  function placeNoAtCardPosition(x, y){
    const c = rect(card);
    const n = rect(btnNo);
    const pad = 10;

    const left = Math.max(pad, Math.min(x - n.width/2, c.width - n.width - pad));
    const top  = Math.max(pad, Math.min(y - n.height/2, c.height - n.height - pad));

    btnNo.style.left = left + "px";
    btnNo.style.top  = top  + "px";

    state.x = left + n.width/2;
    state.y = top + n.height/2;
  }

  function kickAway(pointerX, pointerY){
    const c = rect(card);
    const px = pointerX - c.left;
    const py = pointerY - c.top;

    const dx = state.x - px;
    const dy = state.y - py;
    const dist = Math.hypot(dx, dy) || 1;

    const awayX = dx / dist;
    const awayY = dy / dist;
    const r = randDir();

    const speed = 7.8 + Math.random() * 4.8;
    state.vx = (awayX * 0.75 + r.x * 0.25) * speed;
    state.vy = (awayY * 0.75 + r.y * 0.25) * speed;
  }

  function startChase(){
    if (chaseStarted) return;
    chaseStarted = true;

    const d = randDir();
    state.vx = d.x * (7 + Math.random() * 4);
    state.vy = d.y * (7 + Math.random() * 4);

    rafId = requestAnimationFrame(step);
  }

  function step(){
    if (!chaseStarted) return;

    const c = rect(card);
    const n = rect(btnNo);

    // random drift so it isn't predictable
    state.vx += (Math.random() - 0.5) * 0.25;
    state.vy += (Math.random() - 0.5) * 0.25;

    // cap velocity
    const maxV = 12.5;
    const sp = Math.hypot(state.vx, state.vy);
    if (sp > maxV){
      state.vx = (state.vx / sp) * maxV;
      state.vy = (state.vy / sp) * maxV;
    }

    state.x += state.vx;
    state.y += state.vy;

    const halfW = n.width / 2;
    const halfH = n.height / 2;
    const pad = 10;

    // bounce edges
    if (state.x - halfW < pad){ state.x = pad + halfW; state.vx *= -1; }
    if (state.x + halfW > c.width - pad){ state.x = c.width - pad - halfW; state.vx *= -1; }
    if (state.y - halfH < pad){ state.y = pad + halfH; state.vy *= -1; }
    if (state.y + halfH > c.height - pad){ state.y = c.height - pad - halfH; state.vy *= -1; }

    btnNo.style.left = (state.x - halfW) + "px";
    btnNo.style.top  = (state.y - halfH) + "px";

    rafId = requestAnimationFrame(step);
  }

  function attempt(e){
    showMock();
    startChase();
    const p = (e.touches && e.touches[0]) ? e.touches[0] : e;
    kickAway(p.clientX, p.clientY);
  }

  window.addEventListener("load", () => {
    const c = rect(card);
    placeNoAtCardPosition(c.width * 0.62, c.height * 0.64); // still at start
  });

  btnNo.addEventListener("pointerdown", attempt);
  btnNo.addEventListener("pointerenter", attempt);

  // close-range tease while chasing
  card.addEventListener("pointermove", (e) => {
    if (!chaseStarted) return;

    const n = rect(btnNo);
    const nx = n.left + n.width/2;
    const ny = n.top + n.height/2;
    const dist = Math.hypot(nx - e.clientX, ny - e.clientY);

    if (dist < 155){
      showMock();
      kickAway(e.clientX, e.clientY);
    }
  });

  // --- YES: blur + start continuous hearts on photo ---
  let heartInterval = null;

  function spawnPhotoHeart(){
    if (!heartLayer) return;

    const hearts = ["üíñ","üíò","üíû","üíï","üíó","‚ù§Ô∏è"];
    const h = document.createElement("div");
    h.className = "float-heart";
    h.textContent = hearts[Math.floor(Math.random() * hearts.length)];

    // random start X and drift X (within the photo box)
    const w = heartLayer.clientWidth || 1;
    const startX = Math.random() * w;
    const drift = (Math.random() * 70 - 35); // left/right drift
    const scale = (0.75 + Math.random() * 0.9).toFixed(2);
    const dur = (1.6 + Math.random() * 1.6).toFixed(2) + "s";

    h.style.left = startX + "px";
    h.style.setProperty("--x0", (Math.random() * 20 - 10) + "px");
    h.style.setProperty("--x1", (drift) + "px");
    h.style.setProperty("--s", scale);
    h.style.setProperty("--dur", dur);

    heartLayer.appendChild(h);
    h.addEventListener("animationend", () => h.remove());
  }

  function startHearts(){
    // clear old
    stopHearts();

    // immediate burst so it looks alive right away
    for (let i = 0; i < 18; i++) spawnPhotoHeart();

    // constant stream
    heartInterval = setInterval(() => {
      // spawn a few per tick for a denser look
      spawnPhotoHeart();
      if (Math.random() < 0.7) spawnPhotoHeart();
      if (Math.random() < 0.35) spawnPhotoHeart();
    }, 100); // lower = more hearts (try 120 for even more)
  }

  function stopHearts(){
    if (heartInterval){
      clearInterval(heartInterval);
      heartInterval = null;
    }
    // remove remaining hearts
    if (heartLayer) heartLayer.innerHTML = "";
  }

  btnYes.addEventListener("click", () => {
    toast.textContent = "YAYYY üíñ";
    toast.classList.add("show");
    document.body.classList.add("blur-bg");
    startHearts();
    setTimeout(() => toast.classList.remove("show"), 1400);
  });

  function closeModal(){
    document.body.classList.remove("blur-bg");
    stopHearts();
  }

  shade.addEventListener("click", closeModal);
  closeBtn.addEventListener("click", closeModal);
</script>
</body>
</html>
